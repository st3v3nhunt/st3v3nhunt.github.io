<!doctype html><html><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.80.0"><title>TeamCity Build Pipeline • A blog by st3v3nhunt</title><meta name=twitter:card content="summary"><meta name=twitter:title content="TeamCity Build Pipeline"><meta name=twitter:description content="It has been a while since I setup a build configuration in TeamCity."><meta property="og:title" content="TeamCity Build Pipeline"><meta property="og:description" content="It has been a while since I setup a build configuration in TeamCity."><meta property="og:type" content="article"><meta property="og:url" content="https://st3v3nhunt.github.io/posts/development/teamcity-pipeline/"><meta property="article:published_time" content="2016-04-06T00:00:00+00:00"><meta property="article:modified_time" content="2016-04-06T00:00:00+00:00"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css><link rel=stylesheet href=/scss/hyde-hyde.71157e768c4e111a23c3531b95e0cbb59bbef3c9e6901d36247cb53d6b6be258.css integrity="sha256-cRV+doxOERojw1MbleDLtZu+88nmkB02JHy1PWtr4lg="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://st3v3nhunt.github.io>A blog by st3v3nhunt</a></span><p class=site__description></p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>A blog by st3v3nhunt</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/posts/><span>Posts</span></a></li></ul></div><section class=social><a href=https://twitter.com/st3v3nhunt rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a><a href=https://github.com/st3v3nhunt rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2021 st3v3nhunt
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div><div class=builtwith>Built with <a href=https://gohugo.io>Hugo</a> ❤️ <a href=https://github.com/htr3n/hyde-hyde>hyde-hyde</a>.</div></div></div><div class="content container"><article><header><h1>TeamCity Build Pipeline</h1><div class=post__meta><i class="fas fa-calendar-alt"></i>06-04-2016
in
<a class="badge badge-category" href=/categories/development>DEVELOPMENT</a><br><i class="fas fa-tags"></i><a class="badge badge-tag" href=/tags/ci>ci</a>
<a class="badge badge-tag" href=/tags/development>development</a>
<a class="badge badge-tag" href=/tags/gitlab>gitlab</a>
<a class="badge badge-tag" href=/tags/teamcity>teamcity</a><br><i class="fas fa-clock"></i>3 min read</div></header><div class=post><p>It has been a while since I setup a build configuration in TeamCity. I thought
I would record what I did this time around.</p><p>First up, a bit of background - the solution is a pretty simple .Net library.
It uses NuGet to fetch some dependencies and I want to package the code up as a
NuGet package. I want to make it available in the TeamCity NuGet feed.</p><p>The source code is hosted in a GitLab instance. I wanted to make use of the
GitLab and TeamCity integration so I would be able to see how an MR got on with
CI. This would save people time potentially looking at an MR that doesn&rsquo;t even
pass CI.</p><h2 id=build-steps>Build Steps</h2><p>There are 6 build steps:</p><ol><li>Restore
<a href=https://confluence.jetbrains.com/display/TCD9/NuGet+Installer>NuGet packages</a></li><li>Build with
<a href="https://confluence.jetbrains.com/pages/viewpage.action?pageId=74847254">Visual Studio</a><ul><li>Clean & build the solution in release configuration</li></ul></li><li>Run
<a href="https://confluence.jetbrains.com/pages/viewpage.action?pageId=74847275">Duplicates Finder</a>:<ul><li>Include <code>**/*.cs</code></li><li>Exclude <code>**/*.Tests</code> and <code>**/Properties</code></li></ul></li><li>Run <a href=https://confluence.jetbrains.com/display/TCD9/FxCop>FxCop</a>:<ul><li>Include <code>**/bin/Release/*.dll</code></li><li>Exclude <code>**Tests**</code></li></ul></li><li>Run <a href=https://confluence.jetbrains.com/display/TCD9/NUnit>NUnit</a> tests.<ul><li>Include
<a href=https://confluence.jetbrains.com/display/TCD9/JetBrains+dotCover>JetBrains dotCover</a>
code coverage</li></ul></li><li><a href=https://confluence.jetbrains.com/display/TCD9/NuGet+Pack>Package</a> the
NuGet Packages. The packages are only made available on the TeamCity feed so
there is no
<a href=https://confluence.jetbrains.com/display/TCD9/NuGet+Publish>Nuget Publish</a>
step</li></ol><h2 id=integration-of-ci-and-vcs>Integration of CI and VCS</h2><p>I do love an automated check. And those checks are even better when they are
done for all MRs before anybody has spent any time eyeballing them. In order to
get TeamCity and GitLab to communicate together I did this:</p><ul><li>In GitLab I went into the project&rsquo;s Settings <code>--></code> Services <code>--></code> JetBrains
TeamCity CI screen. I completed the form for the TeamCity server I wanted to
integrate with.</li><li>As instructed on the form in GitLab I went to TeamCity and set the Build
number format to <code>%build.vcs.number%</code>.</li></ul><p>That is it. Now all branches trigger a build in TeamCity and MRs have the
integrated CI status check.</p><h2 id=ci-failure-conditions>CI failure conditions</h2><p>Part of the power of CI is being able to fail the build on pre-defined
conditions. For this pipeline I have additional failure conditions as well as
the standard of any failing tests and non-zero exit codes. The additional
failure conditions are:</p><ul><li>Fail build if build duration (secs) is different by at least 50% compared to
the last successful build</li><li>Fail build if artifacts size (bytes) is different by at least 50% compared to
the last successful build</li><li>Fail build if number of ignored tests is more than 0</li><li>Fail build if number of tests is less by at least 20% compared to the last
successful build</li></ul><p>Some of those criteria are probably a little on the &lsquo;kind&rsquo; side and will not be
suitable for all projects or at all times of their life. For example, having
the number of tests reduce by 20% in a mature project is almost definitely far
too many, as is the build duration and artifacts criteria. On the other hand,
if that project is near to it infancy the build duration might well double if a
new suite of tests was introduced.</p><p>For very young projects it is probably a good idea to disable some of the
advanced failure conditions until such a time when the project has some history
and predictability.</p></div><div class="navigation navigation-single"><a href=/posts/development/gliffy-outage-lessons/ class=navigation-prev><i aria-hidden=true class="fa fa-chevron-left"></i><span class=navigation-tittle>What lessons should one learn from the Gliffy outage?</span></a>
<a href=/posts/development/how-i-work-with-git/ class=navigation-next><span class=navigation-tittle>How I work with Git</span>
<i aria-hidden=true class="fa fa-chevron-right"></i></a></div></article></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-21223368-5','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://use.fontawesome.com/releases/v5.12.1/js/all.js integrity=sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>